<!doctype html>
<style>
html{min-height:100%;line-height:16px;font-size:13px;font-family:sans-serif;color:#333333;}
#playarea{position:absolute;top:0;left:0;bottom:0;right:0;margin:auto;width:640px;height:480px;cursor:none;}
#decoy{position:absolute;top:232px;right:424px;margin:0;text-align:right;z-index:2;}
#decoy a{cursor:inherit;}
#likelike{position:absolute;top:228px;left:297px;z-index:2;}
#pointer{position:fixed;visibility:hidden;pointer-events:none;z-index:3;}
.random{position:absolute;pointer-events:none;z-index:1;}
</style>
<style>/* this one is populated by javascript */</style>
<script>
var
DISTORTION_RADIUS = 240,
DISTORTION_X = -120,
DISTORTION_Y = 0,
DISTORTION_FUNCTION = function (r) { return Math.cos(r * Math.PI) / 2 + 0.5; },

RANDOM_MOVE_TIME = 1000;

var playarea = null;
var likelike = null;
var pointer = null;
var distractInterval = null;
var traceEvents = false;
var ox, oy;

function init() {
	// set up animation CSS
	var ss = document.styleSheets[1];
	var rule = 0;
	if ('transition' in document.documentElement.style) {
		ss.insertRule('.random{transition-duration:' + RANDOM_MOVE_TIME + 'ms;}', rule++);
	} else if ('webkitTransition' in document.documentElement.style) {
		ss.insertRule('.random{-webkit-transition-duration:' + RANDOM_MOVE_TIME + 'ms;}', rule++);
	} else if ('mozTransition' in document.documentElement.style) {
		ss.insertRule('.random{-moz-transition-duration:' + RANDOM_MOVE_TIME + 'ms;}', rule++);
	} else {
		console.log('):');
		return;
	}

	playarea = document.getElementById('playarea');
	likelike = document.getElementById('likelike');
	pointer = document.getElementById('pointer');

	playarea.addEventListener('mousemove', move);
	playarea.addEventListener('mouseover', over);
	playarea.addEventListener('mouseout', out);
	window.addEventListener('resize', resize);
	resize(null);

	addEventListener('keydown', down);
	addEventListener('keyup', up);
}

function over(e) {
	if (traceEvents) console.log('over', e.target, e.relatedTarget);
	if (e.target != playarea) return;
	if (e.relatedTarget != null &&
	    (playarea.compareDocumentPosition(e.relatedTarget) & playarea.DOCUMENT_POSITION_CONTAINED_BY)) return;
	console.info('pointer visible'); // %%%
	pointer.style.visibility = 'visible';
	distractInterval = setInterval(distract, 100);
}

function out(e) {
	if (traceEvents) console.log('out', e.target, e.relatedTarget);
	if (e.target != playarea) return;
	if (e.relatedTarget != null &&
	    (playarea.compareDocumentPosition(e.relatedTarget) & playarea.DOCUMENT_POSITION_CONTAINED_BY)) return;
	console.info('pointer hidden'); // %%%
	pointer.style.visibility = '';
	clearInterval(distractInterval);
}

function move(e) {
	var cx = e.clientX;
	var cy = e.clientY;
	var dx = cx - ox;
	var dy = cy - oy;
	var dist = Math.sqrt(dx * dx + dy * dy);
	var ax, ay;
	if (dist < DISTORTION_RADIUS) {
		var v = DISTORTION_FUNCTION(dist / DISTORTION_RADIUS);
		ax = v * DISTORTION_X;
		ay = v * DISTORTION_Y;
	} else {
		ax = ay = 0;
	}
	pointer.style.top = cy + ay + 'px';
	pointer.style.left = cx + ax + 'px';
}

function resize(e) {
	ox = playarea.offsetLeft + playarea.offsetWidth / 2;
	oy = playarea.offsetTop + playarea.offsetHeight / 2;
}

function down(e) {
	if (e.shiftKey) {
		traceEvents = true;
		playarea.style.backgroundColor = '#f0f0f0';
		playarea.style.cursor = 'crosshair';
	}
}

function up(e) {
	if (!e.shiftKey) {
		traceEvents = false;
		playarea.style.backgroundColor = '';
		playarea.style.cursor = '';
	}
}

function distract() {
	var img = document.createElement('img');
	img.className = 'random';
	img.src = 'http://i.imgur.com/EWmYMN2.png';
	img.style.top = Math.random() * 480 + 'px';
	img.style.left = Math.random() * 640 + 'px';
	playarea.appendChild(img);
	var dummy = img.clientHeight;
	img.style.top = Math.random() * 480 + 'px';
	img.style.left = Math.random() * 640 + 'px';
	setTimeout(function () {
		playarea.removeChild(img);
	}, RANDOM_MOVE_TIME);
}
</script>
<body>
<div id="playarea">
	<p id="decoy">feel free to click <a href="/">here</a></p>
	<iframe id="likelike"    src="//www.facebook.com/plugins/like.php?href=http%3A%2F%2Fhtmlpad.org%2F&amp;send=false&amp;layout=standard&amp;width=450&amp;show_faces=false&amp;font&amp;colorscheme=light&amp;action=like&amp;height=35"   scrolling="no" frameborder="0" style="border:none; overflow:hidden;   width:450px; height:35px;" allowTransparency="true"></iframe>
	<img id="pointer" src="http://i.imgur.com/EWmYMN2.png">
</div>
<script>init();</script>
